<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gold POS — Sales & Finance Tracker (Light)</title>
  <style>
    :root{
      --bg: #f6f5f3;
      --card: #ffffff;
      --accent: #d4af37; /* gold */
      --accent-strong: #b8860b;
      --muted: #6b6f76;
      --border: rgba(16,24,36,0.08);
      --glass: rgba(212,175,55,0.06);
      --text: #0f1724;
      --success: #1f6e3f;
      --danger: #7b1f1f;
      --shadow: 0 8px 30px rgba(16,24,36,0.06);
      --radius: 12px;
      --gap: 14px;
    }

    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
    *{box-sizing:border-box;font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, Arial}
    html,body{height:100%;}
    body{margin:0;background:linear-gradient(180deg,var(--bg) 0%, #ffffff 100%);color:var(--text);padding:20px}
    .container{max-width:1180px;margin:0 auto}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-strong));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:18px;box-shadow:var(--shadow)}
    h1{font-size:18px;margin:0}
    .controls{display:flex;gap:10px;align-items:center}

    input,select,button,textarea{background:var(--card);border:1px solid var(--border);padding:10px 12px;border-radius:10px;color:var(--text);font-size:14px}
    input:focus,select:focus,textarea:focus{outline:none;box-shadow:0 0 0 4px rgba(212,175,55,0.08);border-color:var(--accent-strong)}
    button{cursor:pointer;background:linear-gradient(180deg,var(--accent),var(--accent-strong));color:#fff;border:none;padding:9px 12px;border-radius:10px;font-weight:600}
    button.secondary{background:transparent;color:var(--text);border:1px solid var(--border);font-weight:600}
    button.ghost{background:transparent;border:1px dashed rgba(16,24,36,0.06)}
    button:disabled{opacity:0.6;cursor:not-allowed}

    .grid{display:grid;grid-template-columns:1fr 360px;gap:var(--gap)}
    .card{background:var(--card);padding:16px;border-radius:var(--radius);border:1px solid var(--border);box-shadow:var(--shadow)}
    .card h3{margin:0 0 10px 0;font-size:15px}
    .form-row{display:flex;gap:10px;margin-bottom:12px;align-items:end}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    table{width:100%;border-collapse:collapse}
    thead th{font-size:12px;color:var(--muted);text-align:left;padding:10px;border-bottom:1px solid rgba(16,24,36,0.04)}
    tbody td{padding:10px;border-bottom:1px solid rgba(16,24,36,0.03);font-size:13px}
    tbody tr:nth-child(even){background:linear-gradient(90deg, rgba(212,175,55,0.01), transparent)}
    .muted{color:var(--muted);font-size:13px}
    .summary{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .summary .item{padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(212,175,55,0.03), rgba(212,175,55,0.01));text-align:center;border:1px solid rgba(212,175,55,0.06)}
    .small{font-size:12px}
    .table-wrap{max-height:360px;overflow:auto;border-radius:8px}
    .actions{display:flex;gap:8px}
    .chip{padding:6px 12px;border-radius:999px;background:rgba(16,24,36,0.03);font-size:12px}

    @media (max-width:1000px){ .grid{grid-template-columns:1fr} .summary{grid-template-columns:repeat(2,1fr)} }
    @media (max-width:700px){ body{padding:12px} header{flex-direction:column;align-items:flex-start} .controls{width:100%;display:flex;flex-wrap:wrap} .controls .chip{display:none} .form-row{flex-direction:column;align-items:stretch} .form-row > div{width:100% !important} .form-row [style*="width:"]{width:100% !important} #addSale,#addExpense,#saveSettings{width:100%;} .summary{grid-template-columns:1fr} .table-wrap{max-height:260px} canvas{height:120px} .card{padding:12px} .container{padding:0 6px} }
    @media (max-width:420px){ .logo{width:40px;height:40px} h1{font-size:16px} input,button{font-size:14px;padding:10px} thead th{font-size:11px} tbody td{padding:8px} }
    @media (max-width:520px){ .table-wrap{overflow:auto} table{min-width:680px} }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">Au</div>
        <div>
          <h1>Gold POS</h1>
          <div class="muted small">Sales & finance tracker — light theme</div>
        </div>
      </div>

      <div class="controls">
        <div class="chip">Local storage</div>
        <button id="exportBtn" title="Export CSV">Export CSV</button>
        <button id="downloadJSON" class="secondary" title="Download JSON backup">Backup (JSON)</button>
        <button id="importJSONBtn" class="secondary" title="Import JSON backup">Import (JSON)</button>
        <button id="clearBtn" class="secondary" title="Clear all data">Clear</button>
      </div>
    </header>

    <div class="grid">
      <main>
        <div class="card">
          <h3>Business settings</h3>
          <div class="form-row">
            <div style="flex:1">
              <label for="businessName">Business name</label>
              <input id="businessName" placeholder="e.g. ABC Gold Shop" />
            </div>
            <div style="width:160px">
              <label for="costPerGram">Cost (₦) / gram</label>
              <input id="costPerGram" type="number" step="0.01" />
            </div>
            <div style="width:160px">
              <label for="sellPerGram">Default sell (₦) / gram</label>
              <input id="sellPerGram" type="number" step="0.01" />
            </div>
            <div style="width:100px;display:flex;align-items:end">
              <button id="saveSettings">Save</button>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3>Record a sale</h3>
          <div class="form-row">
            <div style="flex:1">
              <label for="saleGrams">Grams sold</label>
              <input id="saleGrams" type="number" step="0.01" placeholder="e.g. 2.34" />
            </div>
            <div style="width:160px">
              <label for="salePrice">Price (₦) / gram</label>
              <input id="salePrice" type="number" step="0.01" />
            </div>
            <div style="width:180px">
              <label for="saleDate">Date & time</label>
              <input id="saleDate" type="datetime-local" />
            </div>
            <div style="width:120px;display:flex;align-items:end">
              <button id="addSale">Add sale</button>
            </div>
          </div>
          <div class="muted small">Tip: set default sell price above. Cost is used from settings to compute profit.</div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3>Record expense</h3>
          <div class="form-row">
            <div style="flex:1">
              <label for="expenseDesc">Description</label>
              <input id="expenseDesc" placeholder="e.g. Shop rent" />
            </div>
            <div style="width:160px">
              <label for="expenseAmount">Amount (₦)</label>
              <input id="expenseAmount" type="number" step="0.01" />
            </div>
            <div style="width:160px">
              <label for="expenseDate">Date</label>
              <input id="expenseDate" type="date" />
            </div>
            <div style="width:120px;display:flex;align-items:end">
              <button id="addExpense">Add</button>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3>Sales</h3>
          <div class="table-wrap" id="salesTableWrap"></div>
        </div>

      </main>

      <aside>
        <div class="card">
          <h3>Summary</h3>
          <div class="summary" id="summaryGrid">
            <div class="item"><div class="small muted">Turnover</div><div id="turnover" style="font-weight:700;font-size:18px">₦0</div></div>
            <div class="item"><div class="small muted">Total Cost</div><div id="totalCost" style="font-weight:700;font-size:18px">₦0</div></div>
            <div class="item"><div class="small muted">Gross Profit</div><div id="grossProfit" style="font-weight:700;font-size:18px">₦0</div></div>
            <div class="item"><div class="small muted">Total Expenses</div><div id="totalExpenses" style="font-weight:700;font-size:18px">₦0</div></div>
            <div class="item" style="grid-column:1 / -1"><div class="small muted">Net Profit</div><div id="netProfit" style="font-weight:700;font-size:20px">₦0</div></div>
          </div>

          <div style="margin-top:12px">
            <canvas id="turnoverChart"></canvas>
          </div>

          <div style="margin-top:12px">
            <h4>Expenses</h4>
            <div id="expensesList" class="muted small" style="max-height:160px;overflow:auto"></div>
          </div>

          <div style="margin-top:12px">
            <h4>Actions</h4>
            <div class="actions">
              <button id="exportSummary">Export summary CSV</button>
            </div>
          </div>
        </div>
      </aside>
    </div>

    <footer>Data is stored locally in your browser under the key <code>gold-pos-data-v1</code>. Use Backup to download JSON.</footer>
  </div>

  <input id="fileInput" type="file" accept="application/json" style="display:none" />

  <script>
    // Single-file POS: robust tap/click handlers + removed filter (always show all sales)
    const STORAGE_KEY = 'gold-pos-data-v1';

    function defaultState(){
      return { businessName: '', costPerGram: 0, sellPerGram: 0, sales: [], expenses: [] };
    }

    function $(id){ return document.getElementById(id); }

    // helper: bind both click and pointerup/touchstart safely to work on Android and desktop
    function bindTap(el, handler){
      if(!el) return;
      let locked = false;
      const run = (e)=>{ if(locked) return; locked = true; try{ handler(e); }finally{ setTimeout(()=>locked=false, 300); } };
      el.addEventListener('click', run);
      el.addEventListener('pointerup', run);
      el.addEventListener('touchend', run);
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      let state;
      function load(){ const raw = localStorage.getItem(STORAGE_KEY); if(!raw) return defaultState(); try{ return Object.assign(defaultState(), JSON.parse(raw)); }catch(e){ console.warn('Bad storage JSON', e); return defaultState(); } }
      function save(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }catch(e){ showToast('Failed to save data. Storage may be full', true); } }

      state = load();

      // populate fields
      if($('businessName')) $('businessName').value = state.businessName || '';
      if($('costPerGram')) $('costPerGram').value = state.costPerGram || '';
      if($('sellPerGram')) $('sellPerGram').value = state.sellPerGram || '';
      if(state.sellPerGram && $('salePrice')) $('salePrice').value = state.sellPerGram;

      function uid(){ return Math.random().toString(36).slice(2,9); }
      function formatCurrency(n){ return '₦' + Number(n||0).toLocaleString(undefined,{maximumFractionDigits:2}); }

      function showToast(msg, isError=false){ const t=document.createElement('div'); t.textContent=msg; t.style.position='fixed'; t.style.right='16px'; t.style.bottom='20px'; t.style.padding='12px 14px'; t.style.borderRadius='10px'; t.style.boxShadow='0 6px 20px rgba(16,24,36,0.12)'; t.style.fontWeight=600; t.style.background = isError ? 'rgba(123,31,31,0.95)' : 'linear-gradient(90deg,var(--accent),var(--accent-strong))'; t.style.color='#fff'; t.style.zIndex=9999; document.body.appendChild(t); setTimeout(()=>{ t.style.transition='opacity 300ms'; t.style.opacity=0; setTimeout(()=>t.remove(),300); }, 1800); }

      // Save settings
      bindTap($('saveSettings'), ()=>{
        state.businessName = $('businessName').value || '';
        state.costPerGram = parseFloat($('costPerGram').value) || 0;
        state.sellPerGram = parseFloat($('sellPerGram').value) || 0;
        save();
        if(state.sellPerGram && $('salePrice')) $('salePrice').value = state.sellPerGram;
        renderAll();
        showToast('Settings saved');
      });

      // Add sale
      const addSaleBtn = $('addSale');
      function validSale(){ const g = $('saleGrams'); if(!g) return false; const val = parseFloat(g.value); return val && val > 0; }
      if($('saleGrams')) $('saleGrams').addEventListener('input', ()=>{ if(addSaleBtn) addSaleBtn.disabled = !validSale(); });
      if(addSaleBtn) { addSaleBtn.disabled = !validSale(); bindTap(addSaleBtn, ()=>{
        const grams = parseFloat($('saleGrams').value);
        const price = parseFloat($('salePrice').value) || state.sellPerGram || 0;
        const dt = $('saleDate').value ? new Date($('saleDate').value) : new Date();
        if(!grams || grams <= 0){ showToast('Enter valid grams', true); return; }
        state.sales.push({ id: uid(), grams: Number(grams), pricePerGram: Number(price), dateISO: dt.toISOString() });
        save();
        $('saleGrams').value=''; $('saleDate').value=''; addSaleBtn.disabled=true; renderAll(); showToast('Sale added');
      }); }

      // Add expense
      bindTap($('addExpense'), ()=>{
        const desc = $('expenseDesc').value || 'Expense';
        const amount = parseFloat($('expenseAmount').value);
        const dt = $('expenseDate').value ? new Date($('expenseDate').value) : new Date();
        if(!amount || amount <= 0){ showToast('Enter valid amount', true); return; }
        state.expenses.push({ id: uid(), desc, amount: Number(amount), dateISO: dt.toISOString() });
        save();
        $('expenseDesc').value=''; $('expenseAmount').value=''; $('expenseDate').value=''; renderAll(); showToast('Expense added');
      });

      // Export CSV (sales + expenses)
      bindTap($('exportBtn'), exportCSV);
      bindTap($('exportSummary'), exportCSV);
      function exportCSV(){ let rows=[['Type','Date','Item','Grams','UnitPrice','Revenue','Cost','Profit','Amount']]; for(const s of state.sales){ const revenue = s.grams*s.pricePerGram; const cost=s.grams*(state.costPerGram||0); rows.push(['Sale', new Date(s.dateISO).toISOString(), state.businessName||'', s.grams, s.pricePerGram, revenue, cost, revenue-cost, '']); } for(const e of state.expenses){ rows.push(['Expense', new Date(e.dateISO).toISOString(), e.desc, '', '', '', '', '', e.amount]); } const csv = rows.map(r=> r.map(c=> '"'+String(c).replace(/"/g,'""')+'"').join(',')).join('
'); const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='gold-pos-data.csv'; a.click(); URL.revokeObjectURL(url); showToast('CSV exported'); }

      // Backup (JSON)
      bindTap($('downloadJSON'), ()=>{ const blob=new Blob([JSON.stringify(state,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='gold-pos-data.json'; a.click(); URL.revokeObjectURL(url); showToast('Backup downloaded'); });

      // Import (JSON)
      const fileInput = $('fileInput');
      if($('importJSONBtn') && fileInput){ bindTap($('importJSONBtn'), ()=> fileInput.click()); fileInput.addEventListener('change', (ev)=>{ const f=ev.target.files&&ev.target.files[0]; if(!f) return; const reader=new FileReader(); reader.onload = e=>{ try{ const parsed=JSON.parse(e.target.result); if(!confirm('Importing will replace current data. Continue?')) return; state = Object.assign(defaultState(), parsed); save(); renderAll(); showToast('Data imported'); }catch(err){ showToast('Invalid JSON file', true); } }; reader.readAsText(f); ev.target.value=''; }); }

      // Clear
      bindTap($('clearBtn'), ()=>{ if(!confirm('This will delete all stored data in this browser. Continue?')) return; try{ localStorage.removeItem(STORAGE_KEY); state = defaultState(); save(); location.reload(); }catch(e){ showToast('Failed to clear storage', true); } });

      // Render functions - always show all sales (filter removed)
      function renderSales(){ const wrap = $('salesTableWrap'); if(!wrap) return; const sales = state.sales.slice().sort((a,b)=> new Date(b.dateISO)-new Date(a.dateISO)); if(sales.length===0){ wrap.innerHTML='<div class="muted">No sales recorded yet.</div>'; return; } let html='<table><thead><tr><th>Date</th><th>Grams</th><th>Price/gram</th><th>Revenue</th><th>Cost</th><th>Profit</th><th></th></tr></thead><tbody>'; for(const s of sales){ const revenue=s.grams*s.pricePerGram; const cost=s.grams*(state.costPerGram||0); html+=`<tr><td style="white-space:nowrap">${new Date(s.dateISO).toLocaleString()}</td><td>${s.grams}</td><td>${formatCurrency(s.pricePerGram)}</td><td>${formatCurrency(revenue)}</td><td>${formatCurrency(cost)}</td><td>${formatCurrency(revenue-cost)}</td><td><button data-id="${s.id}" class="delSale secondary">Del</button></td></tr>`; } html+='</tbody></table>'; wrap.innerHTML=html; wrap.querySelectorAll('.delSale').forEach(btn=> bindTap(btn, (e)=>{ const id = e.currentTarget.getAttribute('data-id'); if(!confirm('Delete this sale?')) return; state.sales = state.sales.filter(x=>x.id!==id); save(); renderAll(); showToast('Sale deleted'); })); }

      function renderExpenses(){ const el=$('expensesList'); if(!el) return; if(state.expenses.length===0){ el.innerHTML='<div class="muted">No expenses</div>'; return; } const items=state.expenses.slice().sort((a,b)=> new Date(b.dateISO)-new Date(a.dateISO)); el.innerHTML = items.map(i=> `<div style="padding:8px;border-bottom:1px dashed rgba(16,24,36,0.04)"><div style="font-weight:600">${i.desc}</div><div class="small muted">${new Date(i.dateISO).toLocaleDateString()} • ${formatCurrency(i.amount)}</div></div>`).join(''); }

      function computeSummary(){ const turnover = state.sales.reduce((s,x)=> s + x.grams*x.pricePerGram,0); const totalCost = state.sales.reduce((s,x)=> s + x.grams*(state.costPerGram||0),0); const grossProfit = turnover - totalCost; const totalExpenses = state.expenses.reduce((s,x)=> s + x.amount,0); const netProfit = grossProfit - totalExpenses; return {turnover,totalCost,grossProfit,totalExpenses,netProfit}; }

      function renderSummary(){ const s = computeSummary(); if($('turnover')) $('turnover').textContent = formatCurrency(s.turnover); if($('totalCost')) $('totalCost').textContent = formatCurrency(s.totalCost); if($('grossProfit')) $('grossProfit').textContent = formatCurrency(s.grossProfit); if($('totalExpenses')) $('totalExpenses').textContent = formatCurrency(s.totalExpenses); if($('netProfit')) $('netProfit').textContent = formatCurrency(s.netProfit); renderChart(); }

      // chart
      function renderChart(){ const canvas=$('turnoverChart'); if(!canvas) return; const ctx=canvas.getContext('2d'); const DPR=window.devicePixelRatio||1; canvas.width = canvas.clientWidth*DPR; canvas.height = canvas.clientHeight*DPR; ctx.setTransform(DPR,0,0,DPR,0,0); ctx.clearRect(0,0,canvas.width,canvas.height); const sales = state.sales.slice().sort((a,b)=> new Date(a.dateISO)-new Date(b.dateISO)); if(sales.length===0) return; let cum=0; const points = sales.map(s=>{ cum += s.grams*s.pricePerGram; return {t:new Date(s.dateISO), v:cum}; }); const w=canvas.clientWidth; const h=canvas.clientHeight; const maxV = points[points.length-1].v || 1; ctx.beginPath(); ctx.moveTo(0,h-10); ctx.lineTo(w,h-10); ctx.strokeStyle='rgba(16,24,36,0.06)'; ctx.stroke(); ctx.beginPath(); points.forEach((p,i)=>{ const x = (i/(points.length-1))*(w-10)+5; const y = h-12 - ((p.v)/(maxV || 1))*(h-24); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); }); ctx.lineWidth=2; ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--accent-strong')||'#b8860b'; ctx.stroke(); }

      function renderAll(){ renderSales(); renderExpenses(); renderSummary(); }
      renderAll();

      // keep salePrice synced when default sell changes
      if($('sellPerGram')) $('sellPerGram').addEventListener('input', (e)=>{ if($('salePrice')) $('salePrice').value = e.target.value; });
    });
  </script>
</body>
</html>
